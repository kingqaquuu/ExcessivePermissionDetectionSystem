package utils

import (
	"context"
	"fmt"
	"k8sEPDS/pkg/request"
    v1 "k8s.io/api/core/v1"
	metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"
)
// ListSecrets 从指定命名空间中获取所有 Secret，并打印每个 Secret 的名称。
// 参数:
//   token     - 用于访问 API Server 的认证 token
//   namespace - Secret 所在的命名空间
// 返回:
//   error     - 发生错误时返回错误信息
func ListSecrets(token string, namespace string) (*v1.SecretList,error) {
    // 获取 Kubernetes ClientSet，并检查错误
    clientset, err := request.GetClientSet(token)
    if err != nil {
        return nil, fmt.Errorf("获取 ClientSet 失败: %w", err)
    }

    // 列出指定命名空间中的 Secrets
    secretsList, err := clientset.CoreV1().Secrets(namespace).List(context.Background(), metav1.ListOptions{})
    if err != nil {
        return nil, fmt.Errorf("获取 Secrets 失败: %w", err)
    }

    return secretsList, nil
}